---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
Sys.setlocale(category = 'LC_ALL', locale = 'English_United States.1252')
library(purrr)
library(dplyr)
```

# fivbvis

<!-- badges: start -->
<!-- badges: end -->

R package for getting data from [FIVB VIS web server](https://www.fivb.org/VisSDK/VisWebService/#Introduction.html)

## Installation

You can install the development version of fivbvis like so:

``` r
install.packages("remotes") ## if needed
remotes::install_github("wehsLai/fivbvis")
```

## Example

This is a basic example which shows you how to get data:

By default, results are cached in a per-session cache, so if we make the same request again the local results are used, rather than re-downloading:

### 1. Get Tournaments List with Filter Seasons

```{r example1}
library(fivbvis)

v_options(verbose = TRUE)

cl <- list(Filter = c(Seasons = "2021"))
vb_tournaments <- v_get_volley_tournament_list(children = cl)[c("no", "shortNameOrName", "season", "defaultPlayersRanking")]
vb_tournaments
```

### 2. Get Matches List with Filter NoTournament

```{r example2}
s_tournament <- vb_tournaments %>% filter(shortNameOrName == "FIVB VNL MEN")
cl <- list(Filter = c(NoTournament = s_tournament$no),
           Relation = c(Name="Pool", Fields="Name RoundName"))
v_get_volley_match_list(children = cl)[c("dateTimeLocal", "pool.name", "teamAName", "teamBName", "matchResultText")]
```

### 3. Pools List with Filter NoTournament

```{r example3}
pl <- list(Fields = paste0(v_fields("Volleyball Pool"), collapse = " "))
cl <- list(Filter = c(NoTournament = s_tournament$no), ForRanking = NULL)
v_get_volley_pool_list(parent=pl, children = cl)[c("name", "roundName")]
```

### 4. Teams List with Filter NoTournament

```{r example4}
cl <- list(Filter = c(NoTournament = s_tournament$no))
v_get_volley_team_list(children = cl)[c("code", "name")]
```

### 5. Players List with Filter NoTournament, Relation Player

```{r example5}
cl <- list(Filter = c(NoTournament = s_tournament$no), Relation = c(Name="Player", Fields="TeamName FirstName LastName"), Relation = c(Name="Team", Fields="code"))
v_get_volley_player_list(children = cl)[c("team", "noShirt", "position","player.firstName", "player.lastName")]
```

### 6. Statistics List with Filter NoTournament

```{r example6}
pl <- list(Fields = paste(v_fields("Volleyball Statistic"), collapse = " "),
           Include = "Teams", SumBy="Tournament")
cl <- list(Filter = c(NoTournaments = s_tournament$no, MatchesToUse="MatchesStarted"),
           Relation = c(Name="Match", Fields="NoInTournament DateLocal TeamACode TeamBCode MatchResult"),
           Relation = c(Name="Team", Fields="Code"),
           Relation = c(Name="Player", Fields="TeamName FirstName LastName VolleyPosition")
           )
v_get_volley_statistic_list(parent = pl, children = cl)[c("player.teamName","blockPoint", "blockFault", "blockContinue","blockTotal")]
```

### 7. Pool Ranking

```{r example7}
pl <- list(Fields = paste0(v_fields("Volleyball Pool"), collapse = " "))
cl <- list(Filter = c(NoTournament = s_tournament$no, ForRanking=TRUE))
vb_pools_frk <- v_get_volley_pool_list(parent=pl, children = cl)
pl <- list(NoPool = vb_pools_frk$no[1], Fields = paste(v_fields("Volleyball Pool Ranking"), collapse = " "))
v_get_volley_pool_ranking(parent = pl)[c("rankTextWithRepeat", "teamCode", "matchPoints", "matchesWon", "matchesLost", "matches", "setsRatioText", "pointsRatioText")]
```

### 8. Tournament Ranking

```{r example8}
pl <- list(NoTournament = s_tournament$no, Fields = paste(v_fields("Volleyball Tournament Ranking"), collapse = " "))
v_get_volley_tournament_ranking(parent = pl)[c("rankTextWithRepeat", "teamName")]
```

### 9. Player Ranking

```{r example9}
if(!is.na(s_tournament$defaultPlayersRanking)) {
    pl <- list(No=s_tournament$defaultPlayersRanking, NumberOfScorers=10, NumberOfPlayers=10, Skills = "Scorer Spike Block Service Dig Set Reception Libero")
    vb_players_ranking <- v_get_volley_player_ranking(parent=pl)
    vb_players_ranking$Spike[c("TeamCode", "FirstName", "LastName", "Successes", "Faults", "Continues", "TotalAttempts", "Note")]
}
```

<!-- What is special about using `README.Rmd` instead of just `README.md`? You can include R chunks like so:

```{r cars}
summary(cars)
```

You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this. You could also use GitHub Actions to re-render `README.Rmd` every time you push. An example workflow can be found here: <https://github.com/r-lib/actions/tree/v1/examples>.

You can also embed plots, for example:

```{r pressure, echo = FALSE}
plot(pressure)
```

In that case, don't forget to commit and push the resulting figure files, so they display on GitHub and CRAN. -->
